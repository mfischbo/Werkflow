package de.artignition.werkflow.io;

import de.artignition.werkflow.dto.PluginDescriptor;
import de.artignition.werkflow.service.PluginDiscoveryService;
import de.artignition.workflow.api.command.EngineCommand;
import de.artignition.workflow.api.command.EngineCommand.Action;
import de.artignition.workflow.api.command.PluginDescriptorCommand;
import de.artignition.workflow.api.command.PluginDescriptorCommand.Verb;

import java.io.Serializable;

import org.springframework.beans.factory.annotation.Autowired;

public class MessageReceiver implements ResponsiveObjectMessageDelegate {

	@Autowired
	private PluginDiscoveryService		pluginService;

	@Override
	public Serializable handleMessage(Serializable object) {
		if (object instanceof EngineCommand) {
			EngineCommand e = (EngineCommand) object;
			if (e.getAction() == Action.START)
				return "Engine started";
		}
		
		
		if (object instanceof PluginDescriptorCommand) {
			PluginDescriptorCommand c = (PluginDescriptorCommand) object;
			if (c.verb == Verb.GET)
				return pluginService.getAllPlugins().toArray();
		}
		
		
		if (object instanceof EntityCommand) {
			EntityCommand ec = (EntityCommand) object;
			
			if (ec.getType() == PluginDescriptor.class)
				if (ec.getVerb() == Verb.GET) {
					if (ec.getId() == null)
						return pluginService.getAllPlugins().toArray();
				}
			
		}
		
		return "500 - Failed";
	}
}
