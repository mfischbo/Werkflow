package de.artignition.werkflow.io;



import de.artignition.werkflow.service.PluginDiscoveryService;
import de.artignition.workflow.api.command.EngineCommand;
import de.artignition.workflow.api.command.EngineCommand.Action;
import de.artignition.workflow.api.command.PluginDescriptorCommand;
import de.artignition.workflow.api.command.PluginDescriptorCommand.Verb;

import java.io.Serializable;

import org.codehaus.jackson.map.ObjectMapper;
import org.springframework.beans.factory.annotation.Autowired;

public class MessageReceiver implements ResponsiveTextMessageContentDelegate {

	@Autowired
	private ObjectMapper	mapper;
	
	@Autowired
	private PluginDiscoveryService		pluginService;

	@Override
	public String handleMessage(String text) {
		System.out.println(text);
		return "Fuck you!";
	}

	@Override
	public Serializable handleMessage(Serializable object) {
		if (object instanceof EngineCommand) {
			EngineCommand e = (EngineCommand) object;
			if (e.getAction() == Action.START)
				return "Engine started";
		}
		
		
		if (object instanceof PluginDescriptorCommand) {
			PluginDescriptorCommand c = (PluginDescriptorCommand) object;
			if (c.verb == Verb.GET)
				return pluginService.getAllPlugins().toArray();
		}
		
		return "500 - Failed";
	}
}
