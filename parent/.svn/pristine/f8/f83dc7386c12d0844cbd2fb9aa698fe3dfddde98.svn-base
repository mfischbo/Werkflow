package de.artignition.werkflow.demon;

import de.artignition.werkflow.domain.JobDescriptor;
import de.artignition.werkflow.domain.JobInstance;
import de.artignition.werkflow.domain.JobPlugin;
import de.artignition.werkflow.domain.PluginInstance;
import de.artignition.werkflow.plugin.PluginExitStatus.PluginExecutionState;

import java.util.ArrayList;

import org.joda.time.LocalDateTime;

public class JobInstanceExecutor {

	private JobInstance			instance;
	
	public JobInstanceExecutor(JobDescriptor descriptor) {

		// create the instance
		instance = new JobInstance();
		instance.setDateCreated(LocalDateTime.now());
		instance.setDescriptor(descriptor);
		instance.setPluginInstances(new ArrayList<PluginInstance>(descriptor.getPlugins().size()));
		
		for (JobPlugin jp : descriptor.getPlugins()) {
			PluginInstance pi = new PluginInstance();
			pi.setJobInstance(instance);
			pi.setJobPlugin(jp);
			pi.setStepCount(0);
			pi.setState(PluginExecutionState.PREPARING);
			pi.setParameters(jp.getParameters());
			instance.getPluginInstances().add(pi);
		}
	}
}
